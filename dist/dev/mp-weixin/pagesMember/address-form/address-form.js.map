{"version":3,"file":"address-form.js","sources":["../../../../../src/pagesMember/address-form/address-form.vue","../../../../../uniPage:/cGFnZXNNZW1iZXJcYWRkcmVzcy1mb3JtXGFkZHJlc3MtZm9ybS52dWU"],"sourcesContent":["<script setup lang=\"ts\">\nimport { ref } from 'vue'\nimport { getMemberAddressByIdAPI, postMemberAddressAPI, putMemberAddressByIdAPI } from '../../services/address';\nimport { onLoad } from '@dcloudio/uni-app';\nimport type { UniFormsInstance } from '@uni-helper/uni-ui-types';\n\n// 表单数据\nconst form = ref({\n  receiver: '', // 收货人\n  contact: '', // 联系方式\n  fullLocation: '', // 省市区(前端展示)\n  provinceCode: '', // 省份编码(后端参数)\n  cityCode: '', // 城市编码(后端参数)\n  countyCode: '', // 区/县编码(后端参数)\n  address: '', // 详细地址\n  isDefault: 0, // 默认地址，1为是，0为否\n})\n\n// 获取页面参数\nconst query = defineProps<{\n  id?: string\n}>()\n\n// 获取收货地址详情函数\nconst getMemberAddressByIdData = async ()=>{\n  if(query.id){\n    const res = await getMemberAddressByIdAPI(query.id)\n    Object.assign(form.value, res.result)\n  }\n}\n\nonLoad(()=>{\n  getMemberAddressByIdData()\n})\n\n// 动态标题设置\nuni.setNavigationBarTitle({\n  title: query.id ? '修改地址' : '新建地址'\n})\n\n// 收集所在地区\nconst onRegionChange:UniHelper.RegionPickerOnChange = (ev)=>{\n  form.value.fullLocation = ev.detail.value.join(' ')\n  const [provinceCode, cityCode, countyCode] = ev.detail.code!\n  // 将数据合并到对象中\n  Object.assign(form.value, {\n    provinceCode, cityCode, countyCode\n  })\n}\n\n// 收集是否默认收货地址\nconst onSwitchChange:UniHelper.SwitchOnChange = (ev)=>{\n  form.value.isDefault = ev.detail.value ? 1 : 0\n}\n\n// 定义校验规则\nconst rules = {\n  receiver: {\n    rules: [\n      {\n        required: true,\n        errorMessage: '请输入收货人姓名'\n      }\n    ]\n  },\n  contact: {\n      rules: [\n        { required: true, errorMessage: '请输入联系方式' },\n        { pattern: /^1[3-9]\\d{9}$/, errorMessage: '手机号格式不正确' },\n      ],\n    },\n    fullLocation: {\n      rules: [{ required: true, errorMessage: '请选择所在地区' }],\n    },\n    address: {\n      rules: [{ required: true, errorMessage: '请选择详细地址' }],\n    },\n}\n\n// 表单组件实例\nconst formRef = ref<UniHelper.UniFormsInstance>()\n\n// 提交表单\nconst onSubmit = async()=>{\n  try {\n    await formRef.value?.validate?.()\n\n    if(query.id) {\n      // 修改地址 API\n      await putMemberAddressByIdAPI(query.id, form.value)\n    } else {\n      // 新建地址 API\n      await postMemberAddressAPI(form.value)\n    }\n    uni.showToast({\n      icon: 'success',\n      title: query.id ? '修改成功' : '添加成功',\n    })\n    setTimeout(()=>{\n    uni.navigateBack()\n    }, 400)\n  } catch (error) {\n    uni.showToast({\n      icon: 'error',\n      title: '请填写完整信息'\n    })\n  }\n\n\n}\n</script>\n\n<template>\n  <view class=\"content\">\n    <uni-forms :rules=\"rules\" :model=\"form\" ref=\"formRef\">\n      <!-- 表单内容 -->\n      <uni-forms-item name=\"receiver\" class=\"form-item\">\n        <text class=\"label\">收货人</text>\n        <input class=\"input\" placeholder=\"请填写收货人姓名\" v-model=\"form.receiver\" />\n      </uni-forms-item>\n      <uni-forms-item name=\"contact\" class=\"form-item\">\n        <text class=\"label\">手机号码</text>\n        <input class=\"input\" placeholder=\"请填写收货人手机号码\" v-model=\"form.contact\" />\n      </uni-forms-item>\n      <uni-forms-item name=\"fullLocation\" class=\"form-item\">\n        <text class=\"label\">所在地区</text>\n        <picker @change=\"onRegionChange\" class=\"picker\" mode=\"region\" value=\"form.fullLocation.split(' ')\">\n          <view v-if=\"form.fullLocation\">{{ form.fullLocation }}</view>\n          <view v-else class=\"placeholder\">请选择省/市/区(县)</view>\n        </picker>\n      </uni-forms-item>\n      <uni-forms-item name=\"address\" class=\"form-item\">\n        <text class=\"label\">详细地址</text>\n        <input class=\"input\" placeholder=\"街道、楼牌号等信息\" v-model=\"form.address\" />\n      </uni-forms-item>\n      <view class=\"form-item\">\n        <label class=\"label\">设为默认地址</label>\n        <switch @change=\"onSwitchChange\" class=\"switch\" color=\"#27ba9b\" :checked=\"form.isDefault === 1\" />\n      </view>\n    </uni-forms>\n  </view>\n  <!-- 提交按钮 -->\n  <button @tap=\"onSubmit\" class=\"button\">保存并使用</button>\n</template>\n\n<style lang=\"scss\">\npage {\n  background-color: #f4f4f4;\n}\n\n.content {\n  margin: 20rpx 20rpx 0;\n  padding: 0 20rpx;\n  border-radius: 10rpx;\n  background-color: #fff;\n\n  .form-item,\n  .uni-forms-item {\n    display: flex;\n    align-items: center;\n    min-height: 96rpx;\n    padding: 25rpx 10rpx 40rpx;\n    background-color: #fff;\n    font-size: 28rpx;\n    border-bottom: 1rpx solid #ddd;\n    position: relative;\n    margin-bottom: 0;\n\n    // 调整 uni-forms 样式\n    .uni-forms-item__content {\n      display: flex;\n    }\n\n    .uni-forms-item__error {\n      margin-left: 200rpx;\n    }\n\n    &:last-child {\n      border: none;\n    }\n\n    .label {\n      width: 200rpx;\n      color: #333;\n    }\n\n    .input {\n      flex: 1;\n      display: block;\n      height: 46rpx;\n    }\n\n    .switch {\n      position: absolute;\n      right: -20rpx;\n      transform: scale(0.8);\n    }\n\n    .picker {\n      flex: 1;\n    }\n\n    .placeholder {\n      color: #808080;\n    }\n  }\n}\n\n.button {\n  height: 80rpx;\n  margin: 30rpx 20rpx;\n  color: #fff;\n  border-radius: 80rpx;\n  font-size: 30rpx;\n  background-color: #27ba9b;\n}\n</style>\n","import MiniProgramPage from 'D:/uniapp/erabbit-uni-app-vue3-ts/src/pagesMember/address-form/address-form.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","getMemberAddressByIdAPI","onLoad","uni","putMemberAddressByIdAPI","postMemberAddressAPI"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAOA,UAAM,OAAOA,cAAAA,IAAI;AAAA,MACf,UAAU;AAAA;AAAA,MACV,SAAS;AAAA;AAAA,MACT,cAAc;AAAA;AAAA,MACd,cAAc;AAAA;AAAA,MACd,UAAU;AAAA;AAAA,MACV,YAAY;AAAA;AAAA,MACZ,SAAS;AAAA;AAAA,MACT,WAAW;AAAA;AAAA,IAAA,CACZ;AAQD,UAAM,2BAA2B,YAAU;AACzC,UAAG,MAAM,IAAG;AACV,cAAM,MAAM,MAAMC,iBAAAA,wBAAwB,MAAM,EAAE;AAClD,eAAO,OAAO,KAAK,OAAO,IAAI,MAAM;AAAA,MACtC;AAAA,IAAA;AAGFC,kBAAAA,OAAO,MAAI;AACgB;IAAA,CAC1B;AAGDC,kBAAAA,MAAI,sBAAsB;AAAA,MACxB,OAAO,MAAM,KAAK,SAAS;AAAA,IAAA,CAC5B;AAGK,UAAA,iBAAgD,CAAC,OAAK;AAC1D,WAAK,MAAM,eAAe,GAAG,OAAO,MAAM,KAAK,GAAG;AAClD,YAAM,CAAC,cAAc,UAAU,UAAU,IAAI,GAAG,OAAO;AAEhD,aAAA,OAAO,KAAK,OAAO;AAAA,QACxB;AAAA,QAAc;AAAA,QAAU;AAAA,MAAA,CACzB;AAAA,IAAA;AAIG,UAAA,iBAA0C,CAAC,OAAK;AACpD,WAAK,MAAM,YAAY,GAAG,OAAO,QAAQ,IAAI;AAAA,IAAA;AAI/C,UAAM,QAAQ;AAAA,MACZ,UAAU;AAAA,QACR,OAAO;AAAA,UACL;AAAA,YACE,UAAU;AAAA,YACV,cAAc;AAAA,UAChB;AAAA,QACF;AAAA,MACF;AAAA,MACA,SAAS;AAAA,QACL,OAAO;AAAA,UACL,EAAE,UAAU,MAAM,cAAc,UAAU;AAAA,UAC1C,EAAE,SAAS,iBAAiB,cAAc,WAAW;AAAA,QACvD;AAAA,MACF;AAAA,MACA,cAAc;AAAA,QACZ,OAAO,CAAC,EAAE,UAAU,MAAM,cAAc,WAAW;AAAA,MACrD;AAAA,MACA,SAAS;AAAA,QACP,OAAO,CAAC,EAAE,UAAU,MAAM,cAAc,WAAW;AAAA,MACrD;AAAA,IAAA;AAIJ,UAAM,UAAUH,cAAAA;AAGhB,UAAM,WAAW,YAAS;;AACpB,UAAA;AACI,gBAAA,mBAAQ,UAAR,mBAAe,aAAf;AAEN,YAAG,MAAM,IAAI;AAEX,gBAAMI,iBAAwB,wBAAA,MAAM,IAAI,KAAK,KAAK;AAAA,QAAA,OAC7C;AAEC,gBAAAC,iBAAA,qBAAqB,KAAK,KAAK;AAAA,QACvC;AACAF,sBAAAA,MAAI,UAAU;AAAA,UACZ,MAAM;AAAA,UACN,OAAO,MAAM,KAAK,SAAS;AAAA,QAAA,CAC5B;AACD,mBAAW,MAAI;AACfA,wBAAA,MAAI,aAAa;AAAA,WACd,GAAG;AAAA,eACC,OAAO;AACdA,sBAAAA,MAAI,UAAU;AAAA,UACZ,MAAM;AAAA,UACN,OAAO;AAAA,QAAA,CACR;AAAA,MACH;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzGF,GAAG,WAAW,eAAe;"}