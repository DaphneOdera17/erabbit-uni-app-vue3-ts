{"version":3,"file":"profile.js","sources":["../../../../../src/pagesMember/profile/profile.vue","../../../../../uniPage:/cGFnZXNNZW1iZXJccHJvZmlsZVxwcm9maWxlLnZ1ZQ"],"sourcesContent":["<script setup lang=\"ts\">\n  import { onLoad } from '@dcloudio/uni-app';\n  import { getMemberProfileAPI, putMemberProfileAPI } from '@/services/profile';\n  import { ref } from 'vue';\n  import type { Gender, ProfileDetail } from '@/types/member';\n  import { useMemberStore } from '@/stores';\n\n  // 获取屏幕边界到安全区域距离\n  const { safeAreaInsets } = uni.getSystemInfoSync()\n\n  // 获取个人信息\n  const profile = ref({} as ProfileDetail)\n  const getMemberProfileData = async ()=> {\n    const res = await getMemberProfileAPI()\n    profile.value = res.result\n  }\n\n  onLoad(() =>{\n    getMemberProfileData()\n  })\n\n  const memberStore = useMemberStore()\n\n  // 修改头像\n  const onAvatarChange = ()=>{\n    // 调用拍照/选择图片\n    uni.chooseMedia({\n      // 文件个数\n      count: 1,\n      // 文件类型\n      mediaType: ['image'],\n      success:(res)=>{\n        // 本地路径\n        const {tempFilePath} = res.tempFiles[0]\n        // 文件上传\n        uni.uploadFile({\n          url:'/member/profile/avator',\n          name:'file',\n          filePath:tempFilePath,\n          success:(res)=>{\n            if(res.statusCode === 200){\n              const avatar = JSON.parse(res.data).result.avator\n              profile.value!.avatar = avatar\n              memberStore.profile!.avatar = avatar\n            }\n          }\n        })\n      }\n    })\n  }\n\n  // 修改性别\n  const ongenderChange:UniHelper.RadioGroupOnChange =(ev)=> {\n    profile.value.gender = ev.detail.value as Gender\n  }\n\n  // 修改生日\n  const onBirthdayChange:UniHelper.DatePickerOnChange = (ev)=>{\n    profile.value.birthday = ev.detail.value\n  }\n\n  // 修改城市\n  let fullLocationCode:[string, string, string] = ['', '', '']\n  const onFullLocationChange:UniHelper.RegionPickerOnChange = (ev)=>{\n    profile.value.fullLocation = ev.detail.value.join(' ')\n    fullLocationCode = ev.detail.code!\n  }\n\n  // 点击保存提交表单\n  const onSubmit = async ()=>{\n    const { nickname, gender, birthday, profession } = profile.value\n    const res = await putMemberProfileAPI({\n      nickname,\n      gender,\n      birthday,\n      provinceCode: fullLocationCode[0],\n      cityCode: fullLocationCode[1],\n      countyCode: fullLocationCode[2],\n      profession,\n    })\n    memberStore.profile!.nickname = res.result.nickname\n    uni.showToast({icon:'success', title:'保存成功'})\n    setTimeout(()=>{\n      uni.navigateBack()\n    }, 400)\n  }\n</script>\n\n<template>\n  <view class=\"viewport\">\n    <!-- 导航栏 -->\n    <view class=\"navbar\" :style=\"{ paddingTop: safeAreaInsets?.top + 'px' }\">\n      <navigator open-type=\"navigateBack\" class=\"back icon-left\" hover-class=\"none\"></navigator>\n      <view class=\"title\">个人信息</view>\n    </view>\n    <!-- 头像 -->\n    <view class=\"avatar\">\n      <view @tap=\"onAvatarChange\" class=\"avatar-content\">\n        <image class=\"image\" :src=\"profile?.avatar\" mode=\"aspectFill\" />\n        <text class=\"text\">点击修改头像</text>\n      </view>\n    </view>\n    <!-- 表单 -->\n    <view class=\"form\">\n      <!-- 表单内容 -->\n      <view class=\"form-content\">\n        <view class=\"form-item\">\n          <text class=\"label\">账号</text>\n          <text class=\"account\">{{ profile?.account }}</text>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">昵称</text>\n          <input class=\"input\" type=\"text\" placeholder=\"请填写昵称\" v-model=\"profile!.nickname\" />\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">性别</text>\n          <radio-group @change=\"ongenderChange\">\n            <label class=\"radio\">\n              <radio value=\"男\" color=\"#27ba9b\" :checked=\"profile?.gender === '男'\" />\n              男\n            </label>\n            <label class=\"radio\">\n              <radio value=\"女\" color=\"#27ba9b\" :checked=\"profile?.gender === '女'\" />\n              女\n            </label>\n          </radio-group>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">生日</text>\n          <picker\n            @change=\"onBirthdayChange\"\n            class=\"picker\"\n            mode=\"date\"\n            start=\"1900-01-01\"\n            :end=\"new Date()\"\n            :value=\"profile?.birthday\"\n          >\n            <view v-if=\"profile?.birthday\">{{ profile.birthday }}</view>\n            <view class=\"placeholder\" v-else>请选择日期</view>\n          </picker>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">城市</text>\n          <picker @change=\"onFullLocationChange\" class=\"picker\" mode=\"region\" :value=\"profile?.fullLocation?.split(' ')\">\n            <view v-if=\"profile?.fullLocation\">{{ profile.fullLocation }}</view>\n            <view class=\"placeholder\" v-else>请选择城市</view>\n          </picker>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">职业</text>\n          <input class=\"input\" type=\"text\" placeholder=\"请填写职业\" v-model=\"profile.profession\" />\n        </view>\n      </view>\n      <!-- 提交按钮 -->\n      <button @tap=\"onSubmit\" class=\"form-button\">保 存</button>\n    </view>\n  </view>\n</template>\n\n<style lang=\"scss\">\npage {\n  background-color: #f4f4f4;\n}\n\n.viewport {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background-image: url(https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/images/order_bg.png);\n  background-size: auto 420rpx;\n  background-repeat: no-repeat;\n}\n\n// 导航栏\n.navbar {\n  position: relative;\n\n  .title {\n    height: 40px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    font-size: 16px;\n    font-weight: 500;\n    color: #fff;\n  }\n\n  .back {\n    position: absolute;\n    height: 40px;\n    width: 40px;\n    left: 0;\n    font-size: 20px;\n    color: #fff;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n}\n\n// 头像\n.avatar {\n  text-align: center;\n  width: 100%;\n  height: 260rpx;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n\n  .image {\n    width: 160rpx;\n    height: 160rpx;\n    border-radius: 50%;\n    background-color: #eee;\n  }\n\n  .text {\n    display: block;\n    padding-top: 20rpx;\n    line-height: 1;\n    font-size: 26rpx;\n    color: #fff;\n  }\n}\n\n// 表单\n.form {\n  background-color: #f4f4f4;\n\n  &-content {\n    margin: 20rpx 20rpx 0;\n    padding: 0 20rpx;\n    border-radius: 10rpx;\n    background-color: #fff;\n  }\n\n  &-item {\n    display: flex;\n    height: 96rpx;\n    line-height: 46rpx;\n    padding: 25rpx 10rpx;\n    background-color: #fff;\n    font-size: 28rpx;\n    border-bottom: 1rpx solid #ddd;\n\n    &:last-child {\n      border: none;\n    }\n\n    .label {\n      width: 180rpx;\n      color: #333;\n    }\n\n    .account {\n      color: #666;\n    }\n\n    .input {\n      flex: 1;\n      display: block;\n      height: 46rpx;\n    }\n\n    .radio {\n      margin-right: 20rpx;\n    }\n\n    .picker {\n      flex: 1;\n    }\n    .placeholder {\n      color: #808080;\n    }\n  }\n\n  &-button {\n    height: 80rpx;\n    text-align: center;\n    line-height: 80rpx;\n    margin: 30rpx 20rpx;\n    color: #fff;\n    border-radius: 80rpx;\n    font-size: 30rpx;\n    background-color: #27ba9b;\n  }\n}\n</style>\n","import MiniProgramPage from 'D:/uniapp/erabbit-uni-app-vue3-ts/src/pagesMember/profile/profile.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","getMemberProfileAPI","onLoad","useMemberStore","res","putMemberProfileAPI"],"mappings":";;;;;;;;;AAQE,UAAM,EAAE,eAAA,IAAmBA,cAAA,MAAI,kBAAkB;AAG3C,UAAA,UAAUC,kBAAI,CAAA,CAAmB;AACvC,UAAM,uBAAuB,YAAW;AAChC,YAAA,MAAM,MAAMC,iBAAAA;AAClB,cAAQ,QAAQ,IAAI;AAAA,IAAA;AAGtBC,kBAAAA,OAAO,MAAK;AACW;IAAA,CACtB;AAED,UAAM,cAAcC,sBAAAA;AAGpB,UAAM,iBAAiB,MAAI;AAEzBJ,oBAAAA,MAAI,YAAY;AAAA;AAAA,QAEd,OAAO;AAAA;AAAA,QAEP,WAAW,CAAC,OAAO;AAAA,QACnB,SAAQ,CAAC,QAAM;AAEb,gBAAM,EAAC,aAAgB,IAAA,IAAI,UAAU,CAAC;AAEtCA,wBAAAA,MAAI,WAAW;AAAA,YACb,KAAI;AAAA,YACJ,MAAK;AAAA,YACL,UAAS;AAAA,YACT,SAAQ,CAACK,SAAM;AACVA,kBAAAA,KAAI,eAAe,KAAI;AACxB,sBAAM,SAAS,KAAK,MAAMA,KAAI,IAAI,EAAE,OAAO;AAC3C,wBAAQ,MAAO,SAAS;AACxB,4BAAY,QAAS,SAAS;AAAA,cAChC;AAAA,YACF;AAAA,UAAA,CACD;AAAA,QACH;AAAA,MAAA,CACD;AAAA,IAAA;AAIG,UAAA,iBAA6C,CAAC,OAAM;AAChD,cAAA,MAAM,SAAS,GAAG,OAAO;AAAA,IAAA;AAI7B,UAAA,mBAAgD,CAAC,OAAK;AAClD,cAAA,MAAM,WAAW,GAAG,OAAO;AAAA,IAAA;AAIrC,QAAI,mBAA4C,CAAC,IAAI,IAAI,EAAE;AACrD,UAAA,uBAAsD,CAAC,OAAK;AAChE,cAAQ,MAAM,eAAe,GAAG,OAAO,MAAM,KAAK,GAAG;AACrD,yBAAmB,GAAG,OAAO;AAAA,IAAA;AAI/B,UAAM,WAAW,YAAU;AACzB,YAAM,EAAE,UAAU,QAAQ,UAAU,eAAe,QAAQ;AACrD,YAAA,MAAM,MAAMC,qCAAoB;AAAA,QACpC;AAAA,QACA;AAAA,QACA;AAAA,QACA,cAAc,iBAAiB,CAAC;AAAA,QAChC,UAAU,iBAAiB,CAAC;AAAA,QAC5B,YAAY,iBAAiB,CAAC;AAAA,QAC9B;AAAA,MAAA,CACD;AACW,kBAAA,QAAS,WAAW,IAAI,OAAO;AAC3CN,oBAAA,MAAI,UAAU,EAAC,MAAK,WAAW,OAAM,QAAO;AAC5C,iBAAW,MAAI;AACbA,sBAAA,MAAI,aAAa;AAAA,SAChB,GAAG;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnFV,GAAG,WAAW,eAAe;"}